## โครงสร้างข้อมูลเอ็กซ์เอ็มแอล

ภาษาเอ็กซ์เอ็มแอล (XML: eXtensible Markup Language) เป็นภาษาที่ถูกออกแบบมาเพื่อใช้กำหนดโครงสร้างข้อมูลให้เป็นมาตรฐานเดียวกัน ซึ่งจะช่วยให้ผู้พัฒนาแอพพลิเคชันสะดวกในการรับส่งข้อมูล ภาษาเอ็กซ์เอ็มแอลจัดเก็บข้อมูลโดยใช้โครงสร้างการเปิด-ปิดแท็กคล้ายกับภาษาเอชทีเอ็มแอล ถือว่าเป็นส่วนเสริมด้านโครงสร้างข้อมูลของภาษาเอชทีเอ็มแอล เนื่องจากภาษาเอ็กซ์เอ็มแอลไม่สามารถแสดงผลเนื้อหาบนเว็บได้ด้วยตัวเอง

### โครงสร้างของข้อมูลเอ็กซ์เอ็มแอล
โครงสร้างข้อมูลเอ็กซ์เอ็มแอล (XML) มีหลักการจัดโครงสร้างคล้ายกับแท็กในภาษาเอชทีเอ็มแอล (HTML) ทั่วไปเอกสารเอ็กเอ็มแอลมีส่วนขยาย คือ “.xml” ภายในโครงสร้างจะประกอบไปด้วยแท็กหัวข้อที่เรียกว่า “รูท” (root) โดยภายในมีแท็กชั้นซ้อนเพื่อจัดโครงสร้างข้อมูลเรียกว่า “แอตทริบิวต์” ซึ่งในการเก็บโครงสร้างข้อมูลบางแอตทริบิวต์อาจจะมีการจัดเป็นชั้นซ้อนเข้าไปอีกระดับก็ได้แล้วแต่กรณี (Connolly and Hoar, 2015) การออกแบบโครงสร้างในการจัดเก็บ มีรูปแบบการเขียนโครงสร้าง ดังนี้

```
<?xml version="1.0" encoding="UTF-8"?>
<ROOT>
   <CHILD>
       <SUBCHILD>....</SUBCHILD >
   </CHILD>
…………………………………………………..
</ROOT>
```

จากรูปแบบโครงสร้างข้างต้น ส่วนหัวเอกสารเอ็กซ์เอ็มแอล (XML) จะระบุแท็กเพื่อบอกประเภทเอกสารและเอนโค้ดดิ้ง (encoding) <?xml version="1.0" encoding="UTF-8"?> หมายถึง เอกสารเอ็กเอ็มแอลเป็นเวอร์ชัน 1.0 และ เอนโค้ดภาษาด้วย “UTF-8” ซึ่งรองรับภาษาไทย ในตัวเอกสารเอ็กเอ็มแอลจะประกอบไปด้วยแท็กลูก (Child) ที่ผู้ใช้ต้องออกแบบให้เป็นลักษณะโครงสร้างการจัดเก็บข้อมูล ซึ่งแสดงตามตัวอย่างโปรแกรมท

```
01:<?xml version="1.0" encoding="UTF-8"?>
02:<NOTE>
03:	  <TO>ชมพู่</TO>
04:	  <FROM>เบิร์ด</FROM>
05:	  <HEADING>ข้อความแจ้งเตือน</HEADING>
06:	  <MESSAGE>นัดกินข้าวดูหนังวันเสาร์หน้า</MESSAGE>
07:</NOTE>
```

จากตัวอย่างโปรแกรม บรรทัดที่ 02-09 เป็นการจัดโครงสร้างข้อมูลเอ็กซ์เอ็มแอลบันทึกช่วยจำภายใต้แท็ก <NOTE>…</NOTE> ประกอบด้วยโครงสร้างภายใน ได้แก่ ผู้รับ ผู้ส่ง หัวข้อ และ เนื้อหา โดยระบุข้อความไว้ภายใต้แท็ก <TO>…</TO>, <FROM>…</FROM>, <HEADING>…</HEADING> และ <BODY>…</BODY> ตามลำดับ

ในกรณีที่ผู้ใช้ต้องจัดเตรียมข้อมูลของเอ็กซ์เอ็มแอลโดยมีส่วนประกอบการใช้สัญลักษณ์พิเศษที่เกี่ยวข้องกับโครงสร้างคำสั่งเอ็กซ์เอ็มแอล อาทิ เครื่องหมาย “>” หรือ “<” ให้ใช้รหัสอ้างอิงสัญลักษณ์เหล่านั้นตามตัวอย่างรหัสอ้างอิงในตาราง

| สัญลักษณ์	| ความหมาย	| รหัสแทน	| ตัวอย่าง |
| --- | --- | --- | --- |
| <	| สัญลักษณ์น้อยกว่า |	```&lt;``` | 	<TEXT>200 ```&lt;``` 500</TEXT> |
| >	| สัญลักษณ์มากกว่า |	```&gt;``` | 	<TEXT>500 ```&gt;``` 200</TEXT> |
| &	| สัญลักษณ์ “ampersand”	| ```&amp;``` | 	<TEXT>A ```&amp;``` B</TEXT> |
| '	| สัญลักษณ์ “apostrophe”	| ```&apos;``` | 	<TEXT> ```it&apos;s``` </TEXT> |
| "	| สัญลักษณ์ “quotation mark” |	```&quot;``` | 	<TEXT>```&quot;Hi&quot;```</TEXT> |

### การอ่านโครงสร้างข้อมูลเอ็กซ์เอ็มแอลด้วยภาษาจาวาสคริปต์
ภาษาจาวาสคริปต์ (JavaScriipt) เป็นภาษาที่มีความสามารถเรียกใช้งานเอกสารเอ็กซ์เอ็มแอล (XML) ได้ ผู้ใช้สามารถนำไปประยุกต์ใช้สำหรับการแจ้งเตือนข้อมูลข่าวสารบนเว็บไซต์ได้โดยอ่านข้อมูลมาจากเอกสารเอกซ์เอ็มแอล ในที่นี้ จะใช้เอกสารเอกซ์เอ็มแอลตามตัวอย่างก่อนหน้า โดยเป็นเอกสารทดสอบและตั้งชื่อว่า “note.xml” เพื่อแสดงตัวอย่างโปรแกรมเรียกใช้งานเอกสารดังกล่าว  

```
01:<HTML>
02:<HEAD>
03:<TITLE>XML-JavaScript</TITLE>
04:<META charset="UTF-8">
05:</HEAD>
06:<SCRIPT type="text/javascript" type="text/javascript">
07:	<!--
08:	   if (window.XMLHttpRequest) {
09:	      xhttp = new XMLHttpRequest();
10:	   } else {    // สำหรับ IE 5-6
11:	      xhttp = new ActiveXObject("Microsoft.XMLHTTP");
12:	   }
13:	   xhttp.open("GET", "note.xml", false); // เปิดเอกสารเอกซ์เอ็มแอล
14:	   xhttp.send();
15:	   xmlDoc = xhttp.responseXML; 
16:	   var notificationText = 
17:	"ท่านมี " + xmlDoc.getElementsByTagName("HEADING")[0].childNodes[0].nodeValue + "\n" + 
18:	"จาก " + xmlDoc.getElementsByTagName("FROM")[0].childNodes[0].nodeValue +
19:	"ถึง " + xmlDoc.getElementsByTagName("TO")[0].childNodes[0].nodeValue + "\n" +
20:	"ข้อความ: " + xmlDoc.getElementsByTagName("MESSAGE")[0].childNodes[0].nodeValue;
21:	   alert(notificationText);
22:	   -->
23:</SCRIPT>
24:<BODY>
25:</BODY>
26:</HTML>
```

จากตัวอย่างโปรแกรม บรรทัดที่ 06-23 เป็นการเขียนแทรกคำสั่งภาษาจาวาสคริปต์ ให้มีการตรวจสอบและสร้างตัวแปรอ้างอิงชื่อ xhttp เพื่อใช้สำหรับการเปิดไฟล์เพื่อส่งข้อมูลเอกสารเอ็กซ์เอ็มแอล และนำมาจัดให้อยู่ในรูปแบบตัวแปรอาเรย์ xmlDoc (บรรทัดที่ 08-15) จากนั้นจึงทำการอ้างอิงค่าข้อมูลมาจัดรูปแบบเป็นข้อความแจ้งเตือนให้กับตัวแปร notificationText (บรรทัดที่ 16-20) และเรียกใช้ฟังก์ชัน alert() เพื่อแจ้งเตือนข้อมูลดังกล่าว (บรรทัดที่ 21) จะได้ผลลัพธ์เป็นไปตามภาพ

<img src=img/0802.png>

### การอ่านโครงสร้างข้อมูลเอ็กซ์เอ็มแอลด้วยภาษาพีเอชพี
ในการอ่านเอกสารเอ็กซ์เอ็มแอล (XML) ด้วยภาษาพีเอชพี (PHP) สามารถเรียกงานได้ 2 รูปแบบ ได้แก่ การใช้ส่วนเสริมชื่อ “DOM” และการใช้งานส่วน “SimpleXML” ในที่นี้จะยกตัวอย่างเรียกใช้งานในส่วนแรกก่อน ซึ่งจะสร้างออบเจ็คเพื่ออ้างอิงเอกสารเอ็กซ์เอ็มแอลด้วยคลาส DOMDocument โดยจะใช้ไฟล์เอกสารเอ็กซ์เอ็มแอลทดสอบที่ชื่อว่า “note.xml” ตามตัวอย่างโปรแกรม

```
01:<?php
02:	 $doc = new DOMDocument(); // สร้างออบเจ็คจากเม็ดธอด DOMDocument()
03:	 $doc->preserveWhiteSpace = false; // กำหนดให้ไม่นับค่าว่าง
04:	 $doc->load('note.xml'); // โหลดไฟล์เอกสารเอ็กซ์เอ็มแอลกำหนดค่าให้ออบเจ็ค
05:	 $node = $doc->firstChild; // กำหนดตัวแปรอ้างอิงตำแหน่งไปยังแท็กแรก
06:	 echo $node->nodeName."<BR>";
07:	 echo $node->childNodes->item(0)->nodeName.": ".
08:	        $node->childNodes->item(0)->nodeValue."<BR>"; 
09:	 echo $node->childNodes->item(1)->nodeName.": ".
10:	        $node->childNodes->item(1)->nodeValue."<BR>"; 
11:	 echo $node->childNodes->item(2)->nodeName.": ".
12:	        $node->childNodes->item(2)->nodeValue."<BR>"; 
13:	 echo $node->childNodes->item(3)->nodeName.": ".
14:	        $node->childNodes->item(3)->nodeValue."<BR>"; 
15:?>
```

จากตัวอย่างโปรแกรม บรรทัดที่ 02-04 เป็นขั้นตอนการกำหนดตัวแปรออบเจ็ค ($doc) จากฟังก์ชัน DOMDocument() พร้อมทั้งกำหนดตัวแปรอ้างอิงตำแหน่ง ($node) ในการอ่านค่าข้อมูลโดยกำหนดตำแหน่งที่แท็กลูกอันแรก (firstChild) ส่วนบรรทัดที่ 06-14 เป็นส่วนของการแสดงผลโดยใช้ตัวแปรอ้างอิง $node โดยมีการอ้างอิงค่าแอตทริบิวต์ที่สำคัญ 2 ส่วนได้แก่ nodeName หมายถึง ชื่อของแท็ก และ nodeValue หมายถึงค่าของแท็ก โดยฟังก์ชัน item() จะเป็นตัวอ้างอิงชั้นของโหนดลูก (childNode) เช่น item(0) หมายถึง ลำดับของแท็กลูกอันแรก จากโปรแกรมจะได้ผลลัพธ์เป็นไปตามภาพท

<img src=img/0803.png>

### การประยุกต์ใช้เอ็กซ์เอ็มแอลในรูปอาร์เอสเอสด้วยภาษาพีเอชพี
การโหลดเอกสารเอ็กซ์เอ็มแอล (XML) ด้วยภาษาพีเอชพี (PHP) ผู้พัฒนาสามารถใช้งานส่วน “SimpleXML” โดยใช้ฟังก์ชัน simplexml_load_file() ในการทำงาน ในที่นี้จะยกตัวอย่างการโหลดไฟล์อาร์เอสเอส (RSS: Really Simple Syndication) ซึ่งเป็นบริการเว็บฟีดที่จัดเก็บข้อมูลตามโครงสร้างเอ็กซ์เอ็มแอล ตามตัวอย่างภาพ

<img src=img/0804.png>

จากภาพ เป็นเอกสารไฟล์เอ็กซ์เอ็มแอล (XML) ในรูปแบบอาร์เอสเอส (RSS) ซึ่งเป็นบริการสำหรับเว็บฟีดข่าวของสำนักข่าวเมเนเจอร์ออนไลน์ ซึ่งตัวอย่างการใช้ภาษาพีเอชพี (PHP) เพื่อเรียกใช้งานเอกสารดังกล่าวตามตัวอย่างโปรแกรม

```
01:<?php
02:	$url_feed = 'http://www.manager.co.th/RSS/Home/Breakingnews.xml';
03:	$parsed_xml = simplexml_load_file($url_feed);
04:	$total=count($parsed_xml->channel->item);
05:	$perPage = 5;
06:	$num_naviPage=ceil($total/$perPage);
07:	if(!isset($_GET['page'])) {
08:	    $s_key=0;
09:	    $e_key=$perPage;    
10:	    $_GET['page']=1;
11:	} else {
12:	    $s_key=($_GET['page']*$perPage)-$perPage;
13:	    $e_key=$perPage*$_GET['page'];
14:	    $e_key=($e_key>$total)?$total:$e_key;
15:	}
16:	for($i=1; $i<=$num_naviPage; $i++) {
17:	   if ($i==1) {
18:	        echo "<a href=?page=".$i.">หน้า $i</a>"; 
19:	   } else {
20:	        echo "  || <a href=?page=".$i.">หน้า $i</a>";
21:	   }
22:	}
23:	echo "<HR>";
24:	for($i=$s_key; $i<$e_key; $i++) {
25:	   echo "<STRONG>หัวข้อข่าว:</STRONG> ".$parsed_xml->channel->item[$i]->title;
26:	   echo " (".$parsed_xml->channel->item[$i]->pubDate.")<BR>";
27:	    echo "<STRONG>รายละเอียด:</STRONG> ".$parsed_xml->channel->item[$i]->description;
29:	    $link_news=$parsed_xml->channel->item[$i]->link;
30:	    echo "..../<A href='$link_news' target='_blank'>อ่านเพิ่มเติม</A><BR><HR>";
31:	}
32:	echo "หน้าที่: ".$_GET['page']."/$num_naviPage";
33:?>
```
ที่มา: ปรับจาก https://www.ninenik.com/ (ออนไลน์. มีนาคม 2561)

จากตัวอย่างโปรแกรม มีขั้นตอนการทำงานคือ ทำการกำหนดลิงค์สำหรับอ่านไฟล์ฟีดข่าว โหลดเอกสารตามลิงค์ และกำหนดตัวแปรออบเจ็ค $parsed_xml สำหรับการอ้างอิงข้อมูล (บรรทัดที่ 02-04) ตามด้วยส่วนของการกำหนดค่าและคำนวณเพื่อสร้างลิงค์แบ่งหน้าฟีด โดยในที่นี้กำหนดไว้ที่ 5 ข่าวต่อ 1 หน้า (บรรทัดที่ 05-22) ในส่วนต่อมาจะทำการวนรอบอ่านฟีดข่าวตามเลขหน้าที่คำนวณได้ก่อนหน้าเพื่อแสดงรายละเอียดข่าวประกอบด้วย หัวข้อข่าว (title) วันที่ (pubDate) รายละเอียดข่าว (description) และ ลิงค์ไปยังหน้าข่าว (link) (บรรทัดที่ 24-31) และ บรรทัดที่ 32 คือ การแสดงเลขที่หน้าของฟีดข่าวปัจจุบัน แสดงผลลัพธ์ตามภาพ

<img src=img/0805.png>

---
#### [<< หน้าก่อนหน้า](0801.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0803.md)
---

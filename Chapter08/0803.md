## โครงสร้างข้อมูลเจสัน

ปัจจุบันโครงสร้างข้อมูลเจสัน (JavaScript Object Notation) ถูกยอมรับให้เป็นมาตรฐานหนึ่งในกลายนำมาใช้สำหรับบริการเลือกเปลี่ยนข้อมูล มีข้อดี คือ เป็นภาษาที่อิสระและมีขนาดโครงสร้างที่เข้าใจง่ายไม่ซับซ้อน

### โครงสร้างของข้อมูลเจสัน
โครงสร้างข้อมูลเจสัน (JSON) มีหลักการจัดโครงสร้างแบบ key : value (คีย์ : ค่า) ทั่วไปมีส่วนขยาย คือ “.json” มีรูปแบบการเขียนโครงสร้างอย่างง่าย ดังนี้

```
{  "ชื่อคีย์1":ค่า,
   "ชื่อคีย์2":ค่า,
    …………………,
   "ชื่อคีย์2":ค่า  }
```

จากรูปแบบโครงสร้างข้างต้นขอยกตัวอย่างการจัดรูปแบบข้อมูลตามโครงสร้างดังกล่าว ดังนี้

```
  {"name":"John", "age":30, "city":"New York"}
```

นอกจากนี้ โครงสร้างข้อมูลเจสัน (JSON) ยังสามารถจัดให้อยู่ในรูปแบบโครงสร้างข้อมูลชั้นซ้อน ดังนี้

```
{"ชื่อคีย์หลัก":[
    { "ชื่อคีย์1":ค่า,………….,"ชื่อคีย์2":ค่า },
    ………………………………………………….,
    { "ชื่อคีย์1":ค่า,………….,"ชื่อคีย์2":ค่า }
]}
```

จากรูปแบบโครงสร้างข้างต้นขอยกตัวอย่างการจัดรูปแบบข้อมูลตามโครงสร้างดังกล่าว ดังนี้

```
01:{"employees":[
02:	    {"name":"John", "age":30, "city":"New York"},
03:	    {"name":"Anna", "age":25, "city":"New York"},
04:	    {"name":"Peter", "age":16, "city":"New York"}
05:]}
```

จากตัวอย่าง คือ โครงสร้างข้อมูลพนักงาน (employees) ในรูปแบบเจสัน ประกอบไปด้วยรายการ 3 แถว จัดเก็บชื่อ (name) อายุ (age) และเมือง (city)

### การอ่านโครงสร้างข้อมูลเจสันด้วยภาษาจาวาสคริปต์
ภาษาจาวาสคริปต์ (JavaScriipt) จะอ่านโครงสร้างข้อมูลเจสัน (JSON) ในรูปแบบของตัวแปรวัตถุ โดยใช้ฟังก์ชัน JSON.parse() ซึ่งสามารถเข้าถึงข้อมูลได้อย่างสะดวกกรวดเร็วดังที่ได้แสดงไว้ตามตัวอย่างโปรแกรม

```
01:<HTML>
02:<BODY>
03:Create Object from JSON String<BR>
04:<p id="demo"></p>
05:<SCRIPT>
06:	     var txt = '{"name":"John", "age":30, "city":"New York"}'
07:	     var obj = JSON.parse(txt);
08:	     document.getElementById("demo").innerHTML = obj.name + ", " + obj.age;
09:</SCRIPT>
10:</BODY>
11:</HTML>
```
แหล่งที่มา: https://www.w3schools.com/js/js_json_xml.asp (ออนไลน์, 2561)

จากโปรแกรม บรรทัดที่ 05-09 เป็นส่วนของภาษาจาวาสคริปต์ มีการดำเนินการ ได้แก่ กำหนดโครงสร้างข้อมูลแบบเจสัน (JSON) แทนด้วย txt จากนั้นจึงสร้างเจสันออปเจ็ค obj และ สั่งแสดงผลชื่อ (obj.name) และ อายุ (obj.age) ไปยังตำแหน่งแท็กเอชทีเอ็มแอล <p id="demo"></p> (บรรทัดที่ 4 ซึ่ง id="demo") ซึ่งจะได้ผลลัพธ์ดังภาพ

<img src=img/0806.png>

### การประยุกต์ใช้โครงสร้างข้อมูลเจสันด้วยภาษาพีเอชพี
การใช้ภาษาพีเอชพี (PHP) ทำงานกับโครงสร้างข้อมูลแบบเจสัน (JSON) จะใช้วิธีการทำงานโดยใช้ฟังก์ชันในการปรับโครงสร้างเพื่ออ่านและส่งค่า ดังตาราง

| ฟังก์ชั่น	| ความหมาย |
| --- | --- |
| json_encode()	| จัดข้อมูลอ้างอิงแบบพอยเตอร์ให้อยู่ในรูปโครงสร้างแบบเจสัน |
| json_decode()	| จัดข้อมูลแบบเจสันให้อยู่รูปแบบข้อมูลอ้างอิงพอยเตอร์ |


จากตาราง คำสั่ง json_encode() จะใช้ในการณีที่ต้องการจัดข้อมูลให้อยู่ในรูปแบบโครงสร้างแบบเจสันเพื่อทำการส่งออกไปยังไคลเอ็นต์ที่ร้องขอ ส่วนคำสั่ง json_decode() จะให้ในกรณีที่ผู้ใช้รับข้อมูลโครงสร้างแบบเจสันมาประมวลผลด้วยภาษาพีเอชพีซึ่งจะต้องจัดให้อยู่ในรูปแบบของตัวแปรอ้างอิงพอยเตอร์เพื่อเรียกใช้ค่าข้อมูล

```
01:<?php
02:	  $myObj = new \stdClass(); // แก้การ Creating default object from empty value
03:	  $myObj->name = "John";
04:	  $myObj->age = 30;
05:	  $myObj->city = "New York";
06:	  $myJSON = json_encode($myObj);
07:	  $myJSON
08:	  // เขียนไฟล์
09:	  $fp = fopen("myjson.json", "w");
10:	  fwrite($fp, $myJSON);
11:	  fclose($fp); 
12:?>
```

จากตัวอย่างโปรแกรม บรรทัดที่ 02-04 ได้กำหนดค่าตัวแปรอ้างอิง $myObj ประกอบด้วยชื่อ (name) อายุ (age) และ เมือง (city) จากนั้นจึงทำการจัดข้อมูลอ้างอิงแบบพอยเตอร์ให้อยู่ในรูปโครงสร้างแบบเจสันเก็บในตัวแปรออปเจ็ค $myJSON (บรรทัดที่ 05) จากการแสดง $myJSON (บรรทัดที่ 06) จึงได้ผลลัพธ์เป็นโครงสร้างแบบเจสัน ดังภาพที่ 8.7 ส่วนบรรทัดที่ 09-11 เป็นการเขียนไฟล์ในโครงสร้างเจสันเพื่อนำไปใช้ให้บริการซึ่งจะนำเสนอวิธีอ่านในตัวอย่างโปรแกรมลำดับต่อไป

<img src=img/0807.png>

```
01:<?php
02:	   $URL = "myjson.json";
03:	   if($response = @file_get_contents($URL)) { // @ = ไม่ต้องแจ้งข้อผิดพลาด
04:	      $myObj = json_decode($response);
05:	   }
06:	   echo $myObj->name."<BR>";
07:	   echo $myObj->age."<BR>";
08:	   echo $myObj->city;
09:?>
```

จากตัวอย่างโปรแกรม มีลำดับการทำงาน คือ ทำการกำหนดค่าตำแหน่งที่จะทำงานอ่านโครงสร้างข้อมูลเจสัน (บรรทัดที่ 02) ทำการอ่านข้อมูลด้วยคำสั่ง @file_get_contents($URL) (บรรทัดที่ 03) และ ทำการจัดข้อมูลแบบเจสันให้อยู่รูปแบบข้อมูลอ้างอิงพอยเตอร์ $myObj (บรรทัดที่ 04) จากนั้น จึงอ้างอิงเพื่อแสดงค่าข้อมูลชื่อ (name) อายุ (age) และ เมือง (city) ตามลำดับ (บรรทัดที่ 06-08) ได้ผลลัพธ์ตามภาพ

<img src=img/0808.png>

### การประยุกต์ใช้ข้อมูลโครงสร้างเจสัน
ด้วยข้อมูลเจสันที่ใช้งานกันจะอยู่โดยทั่วไปมักจัดอยู่ในรูปแบบแถวชั้นซ้อน ซึ่งจากโครงสร้างข้อมูลตัวอย่างโปรแกรมที่ 8.5 ได้ทำงานจัดเก็บในชื่อ “employees.json” สามารถนำโครงสร้างข้อมูลเจสันดังกล่าวไปประยุกต์ใช้งานได้ ดังตัวอย่างโปรแกรม

```
01:<?php
02:	   $URL = "employees.json";
03:	   if($response = @file_get_contents($URL)) { // @ = ไม่ต้องแจ้งข้อผิดพลาด
04:	      $myObj = json_decode($response);
05:	   }
06:	   foreach($myObj as $employees) {
07:	     foreach($employees as $data) {
08:	        echo $data->name."<BR>";
09:	        echo $data->age."<BR>";
10:	        echo $data->city."<BR>";
11:	     }
12:	   }
13:?>
```

จากตัวอย่างโปรแกรม มีลำดับการทำงาน คือ ทำการกำหนดค่าตำแหน่งที่จะทำงานอ่านโครงสร้างข้อมูลเจสัน (บรรทัดที่ 02) ทำการอ่านข้อมูลด้วยคำสั่ง @file_get_contents($URL) (บรรทัดที่ 03) และ ทำการจัดข้อมูลแบบเจสันให้อยู่รูปแบบข้อมูลอ้างอิงพอยเตอร์ $myObj (บรรทัดที่ 04) จากนั้น จึงทำการวนรอบเพื่อเลื่อนตัวชี้ตำแหน่งพอยเตอร์ไปทีละแถวเพื่ออ้างอิงแสดงค่าข้อมูลชื่อ (name) อายุ (age) และ เมือง (city) ตามลำดับ (บรรทัดที่ 06-12) ได้ผลลัพธ์ตามภาพ

<img src=img/0809.png>

---
#### [<< หน้าก่อนหน้า](0802.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0810.md)
---

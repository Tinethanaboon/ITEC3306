## การติดตามเซสชันด้วยภาษาพีเอชพี

เซสชัน (Session) คือ การทำให้เว็บเบราว์เซอร์จดจำข้อมูลที่ต้องการทำให้สามารถเรียกใช้งานข้อมูลดังกล่าวได้ทุกครั้งที่ต้องการ ซึ่งเซสชันจะเป็นข้อมูลที่สร้างขึ้นในฝั่งเว็บไคลเอ็นต์เพื่อตรวจสอบ และเมื่อมีการเรียกใช้งานจะส่งข้อมูลไปยังเว็บเซิฟเวอร์ผ่านทางยูอาร์แอลแอดเดรส (URL Address) ของเว็บเบราว์เซอร์ และเซสชันจะถูกปิดไปเมื่อผู้ใช้ปิดเว็บไซต์ดังกล่าว การใช้งานเซสชันส่วนใหญ่จะประยุกต์ใช้สำหรับตรวจสอบสถานะการใช้งานในขณะเปิดเว็บเบราว์เซอร์เพื่อใช้งานเว็บไซต์อยู่ ตัวอย่างเช่น การคงสถานะการล็อกอินใช้งานระบบ เป็นต้น ภาษาพีเอชพี (PHP) มีวิธีสร้างและทำการติดตามเซสชันผ่านตัวแปร ```$_SESSION[]``` เพื่อจัดเก็บค่าเซสชัน 

### การเริ่มเซสชันและการกำหนดค่าตัวแปรเซสชัน
การเริ่มเซสชันจะสั่งการด้วยฟังก์ชัน session_start() ไว้ส่วนหัวของเอกสารเว็บเพจที่ต้องการใช้งานเซสชันเสมอ ซึ่งรูปแบบการใช้งานมีดังนี้

```
session_start();
```

การกำหนดค่าตัวแปรเซสชันจะกำหนดผ่านตัวแปรเซสชัน $_SESSION[] ดังนี้

```
$_SESSION['ชื่ออ้างอิง'] = "ค่าของเซสชันที่อ้างอิง";
```

เซสชันเป็นข้อมูลแบบอาเรย์สามารถสร้างขึ้นมาได้หลายค่า โดยระบุ ชื่ออ้างอิง ค่าเซสชั่นพร้อมกับ ค่าของเซสชันที่อ้างอิง นั้น ๆ โดยการกำหนดค่าเซสชันเพื่อใช้งาน แสดงดังตัวอย่างโปรแกรม

```
01:<?php
02:	   session_start();
03:	   $_SESSION['UserName'] = " Steve Rogers";
04:	   $_SESSION["UserType"] = "Administrator";
05:	   session_write_close(); // ปิดการเขียนเซสชั่นใช้กรณีไม่ต้องการเขียนค่าเพิ่มเติมแล้ว
06:	   echo "<B>Started and Registered Session</B><BR>";
07:	   echo "UserName: ".$_SESSION['UserName']."<BR>";
08:	   echo "UserType: ".$_SESSION['UserType'];
09:?>
```

จากตัวอย่างโปรแกรม เป็นการกำหนดค่าเซสชันด้วยการเก็บค่าชื่อ (UserName) และประเภทผู้ใช้ระบบ (UserType) ไว้ที่ตัวแปรเซสชัน ```$_SESSION['UserName']``` และ ```$_SESSION['UserType']``` ตามลำดับ โดยค่าเซสชันที่ได้กำหนดไว้จะถูกนำไปใช้สำหรับการตรวจสอบสถานะการล็อกอินใช้งานระบบของผู้ใช้ ซึ่งจากโปรแกรมบรรทัดที่ 03-04 ได้สมมุติว่าเซสชันผู้ใช้มีชื่อ ```$_SESSION['UserName']``` และ ประเภท ```$_SESSION["UserType"]``` มีค่าเท่ากับ “Steve Rogers” และ “Administrator” ตามลำดับ เมื่อผู้ใช้กำหนดค่าเซสชันครบถ้วนแล้วก็จะปิดขอบเขตของค่าเซสชันได้ด้วยคำสั่ง ```session_write_close()``` ในบรรทัดที่ 05 ส่วนบรรทัดที่ 06-08 เป็นการแสดงสถานะและข้อมูลเซสชัน ซึ่งผลลัพธ์ของโปรแกรมแสดงดังภาพ

<img src=img/0601.png>

### การตรวจสอบและตั้งรับค่าตัวแปรเซสชัน
เมื่อเปิดใช้เซสชันด้วยคำสั่ง ```session_start()``` ผู้ใช้สามารถเรียกใช้งานค่าเซสชันที่เคยกำหนดค่าไว้ก่อนหน้าได้ โดยเขียนโปรแกรมตั้งรับค่าตัวแปร ```$_SESSION[]``` เพื่อนำไปใช้งาน ตามตัวอย่างการเขียนโปรแกรม

```
01:<?php
02:	    session_start();
03:	    if(!empty($_SESSION['UserName'])) {
04:	          $UserName = $_SESSION['UserName'];
05:	          $UserType = $_SESSION['UserType'];
06:	          echo "<B>Get Session</B><BR>";
07:	          echo "User Name: ".$UserName."<BR>";
08:	          echo "User Type: ".$UserType;
09:	    } else {
10:	          echo "<B>Closed Session</B>";
11:	    }
12:?>
```

จากโปรแกรม บรรทัดที่ 02 เป็นการเปิดใช้เซสชันด้วยคำสั่ง ```session_start()```  และในบรรทัดที่ 03 ได้ทำการตรวจสอบค่าเซสชัน ```$_SESSION['UserName']``` ว่าเป็นค่าว่างหรือไม่   โดยผลลัพธ์จะเป็นไปได้ 2 ทางเลือก คือ ถ้าเป็น “จริง” จะทำคำสั่งบรรทัดที่ 04-08 แต่ถ้าเป็น “เท็จ” จะทำคำสั่งบรรทัดที่ 11 ซึ่งผลลัพธ์ทั้ง 2 ทางเลือก แสดงดังภาพ

<img src=img/0602.png>

### การลบค่าและการล้างเซสชัน
ในกรณีที่ผู้ใช้ต้องการลบเซสชันบางค่า อาทิ ต้องการลบค่าที่ได้ลงทะเบียนไว้เพื่อใช้งานชั่วคราว ดังนั้น หากมีการลงทะเบียนค่าตัวแปร  ```$_SESSION['UserMode']``` ไว้ โดยเมื่อใช้งานเสร็จเรียบร้อยสามารถใช้ฟังก์ชัน unset() ซึ่งเป็นฟังก์ชันสำหรับลบค่าข้อมูลในหน่วยความจำเป็นผลทำให้มีเนื้อที่บนหน่วยความจำเพิ่มขึ้น โดยรูปแบบโครงสร้างการใช้งาน ดังนี้ 

```
unset(ชื่อตัวแปร);
```

การเขียนคำสั่งยกเลิกค่าเซสชัน มีดังนี้  

```
<?php
   session_start();
   unset($_SESSION['UserMode']); // ลบรายการเซสชัน $_SESSION['UserMode']
?>
```

สำหรับในกรณีที่ต้องการล้างหรือทำลายค่าเซสชันทั้งหมด เช่น เมื่อผู้ใช้ทำการล็อกเอาท์ออกจากระบบจะต้องลบค่าเซสชันต่าง ๆ ของผู้ใช้ออกทั้งหมด สามารถสั่งการได้ด้วยการใช้ฟังก์ชัน session_destroy() ดังตัวอย่างโปรแกรม

```
01:<?php 
02:	    session_start();
03:	    session_destroy(); // ลบค่าทั้งหมดของตัวแปร $_SESSION[] 
04:	    echo "<B>Destroyed Session</B>";
05:?>
```

จากตัวอย่างโปรแกรม บรรทัดที่ 02 ได้เปิดใช้งานเซสชัน ส่วนบรรทัดที่ 03 จะเป็นคำสั่งการล้างข้อมูลเซสชันด้วยคำสั่ง session_destroy() และในบรรทัดที่ 04 โปรแกรมจะแสดงสถานะการทำลายเซสชัน ซึ่งผลลัพธ์แสดงดังภาพ

<img src=img/0603.png>

การใช้งานเซสชันมีลำดับการสร้างและติดตาม ได้แก่ การเริ่มต้นเซสชันและกำหนดค่าตัวแปรเซสชัน การตรวจสอบสถานะตัวแปรเซสชัน และ การยกเลิกค่าเซสชันหรือล้างเซสชัน โดยเมื่อได้ทำการล้างเซสชันไปแล้ว จะไม่สามารถเรียกใช้งานค่าเซสชันได้อีกต่อไปจนกว่าจะได้มีการเปิดเซสชันลงทะเบียนค่าขึ้นมาใหม่ ซึ่งฟังก์ชันเกี่ยวกับเซสชันที่สำคัญสามารถสรุปได้ ดัง ตาราง

| ฟังก์ชัน | ความหมาย |	ตัวอย่างการใช้งาน |
| --- | --- | --- |
| session_start() |	เริ่มใช้เซสชัน | ต้องทุกครั้งด้วย ```session_start();``` | 
| session_write_close() |	เขียนปิดข้อมูลเซสชัน | ปิดหลังจากค่าเซสชันสุดท้ายถูกประกาศด้วย ```session_write_close()``` |
| unset() |	ลบค่าบางเซสชัน |	ลบบางเซสชันที่ไม่ได้ใช้งานแล้ว ตัวอย่าง เช่น ```unset($_SESSION['UserMode']);``` |
| session_destroy() |	ล้างเซสชัน |	ล้างค่าเซสชันทั้งหมด |
| session_registor() |	ลงทะเบียนเซสชัน |	ถูกยกเลิกคำสั่งไป โดยจะลงทะเบียนค่าเซสชันได้ทันที ตัวอย่าง เช่น ```$UserName = $_SESSION['UserName'];``` |

---
#### [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0602.md)
---

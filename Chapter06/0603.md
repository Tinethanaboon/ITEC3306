## การอ่านเขียนไฟล์ด้วยภาษาพีเอชพี

การจัดการไฟล์เป็นอีกวิธีที่ใช้ในการจัดเก็บข้อมูล โดยทั่วไปนิยมกับการบันทึกการตั้งค่าต่าง ๆ ของระบบ ซึ่งการจัดเก็บไฟล์ข้อมูลจะถูกจัดเก็บไว้ที่ไฟล์ฝั่งเว็บเซิร์ฟเวอร์ทำให้สามารถเข้าถึงและแก้ไขได้สะดวก การจัดการไฟล์ในภาษาพีเอชพี (PHP) มีขั้นตอนการใช้คำสั่ง ดังนี้

### การเปิดไฟล์และปิดไฟล์
การเปิดไฟล์จะใช้ฟังก์ชัน fopen() มีรูปแบบโครงสร้างคำสั่ง ดังนี้

```
fopen("ชื่อไฟล์ที่ต้องการเปิด", "ประเภทการเปิด");
```

โดย ชื่อไฟล์ที่ต้องการเปิด จะเป็นการระบุชื่อไฟล์หรือแฟ้มข้อมูล อาทิ userlog.txt ส่วน โหมดการเปิด จะเป็นการระบุโหมดการเปิดไฟล์ให้ตรงตามวัตถุประสงค์การใช้งานไฟล์ โดยการทำงานเกี่ยวกับแฟ้มข้อมูลไม่ว่าจะเป็นการอ่านหรือการเขียนข้อมูลในไฟล์ ต้องเริ่มต้นด้วยการใช้คำสั่งเปิดแฟ้มข้อมูลเสมอ

| โหมด | รายละเอียด |
| --- | --- |
| r | เปิดแฟ้มข้อมูลเพื่ออ่านอย่างเดียวเริ่มที่ตำแหน่งต้นไฟล์ |
| w | เปิดแฟ้มข้อมูลเพื่อเขียน โดยจะทำการเขียนทับแฟ้มข้อมูลเก่า |
| a | เปิดแฟ้มข้อมูลเพื่อเขียน โดยจะทำการเขียนต่อจากท้ายไฟล์ |
| x | เปิดแฟ้มข้อมูลเพื่อเขียนไฟล์ใหม่ จะไม่สามารถเขียนได้ถ้ามีไฟล์อยู่แล้ว |
| r+ | เปิดแฟ้มข้อมูลเพื่ออ่าน-เขียน แฟ้มข้อมูลเก่าเริ่มที่ตำแหน่งต้นไฟล์ |
| w+ | เปิดแฟ้มข้อมูลเพื่ออ่าน-เขียน โดยจะทำการเขียนทับแฟ้มข้อมูลเก่า |
| a+ | เปิดแฟ้มข้อมูลเพื่ออ่าน-เขียน โดยจะทำการเขียนต่อจากท้ายไฟล์ |
| x+ | เปิดแฟ้มข้อมูลเพื่ออ่าน-เขียนไฟล์ใหม่ จะไม่สามารถเขียนได้ถ้ามีไฟล์อยู่แล้ว |

จากตาราง แสดงโหมดการเปิดไฟล์ของฟังก์ชัน fopen() โดยผู้ใช้จะต้องเลือกโหมดการเปิดให้ตรงตามจุดประสงค์การใช้งาน ตัวอย่างเช่น ต้องการเปิดไฟล์ “userlog.txt” ในโหมดเพื่ออ่านอย่างเดียว “r” สามารถเขียนคำสั่งได้ ดังนี้

```
$myfile = fopen("userlog.txt", "r");   // เปิดไฟล์ userlog.txt แบบอ่านอย่างเดียว
```

จากตัวอย่างข้างต้น การเปิดไฟล์จะเปิดผ่านตัวแปรอ้างอิงชื่อ $myfile เป็นแบบอ่านอย่างเดียว อย่างไรก็ตาม ในกรณีที่มีการเปิดไฟล์ในโหมดแบบเขียน เช่น โหมด “w” หากบนเว็บไซต์ไม่มีไฟล์ชื่อนั้นปรากฏอยู่ ระบบจะสร้างไฟล์เปล่าขึ้นตามชื่อที่ระบุมาให้ใหม่ นอกจากนี้ เมื่อผู้ใช้ดำเนินการอ่านหรือเขียนไฟล์เรียบร้อยจะต้องทำการปิดไฟล์ทันทีโดยใช้คำสั่ง fclose() ซึ่งมีรูปแบบโครงสร้างคำสั่ง ดังนี้

```
fclose(ชื่อตัวแปรอ้างอิงการเปิดไฟล์);
```

### การอ่านไฟล์แบบระบุขนาด
การอ่านไฟล์ในภาษาพีเอชพี (PHP) โดยการระบุขนาดการอ่านข้อความ จะใช้ฟังก์ชัน fread() ซึ่งมีรูปแบบโครงสร้างคำสั่ง ดังนี้

```
fread(ตัวแปรอ้างอิงการเปิดไฟล์, ขนาดการอ่าน);
```

การอ่านไฟล์แบบระบุขนาดจะต้อง ระบุ ตัวแปรอ้างอิงการเปิดไฟล์ และ ขนาดการอ่าน ซึ่งหากต้องการอ่านข้อมูลทั้งหมดจากไฟล์ สามารถระบุขนาดด้วยการใช้ฟังก์ชันหาขนาดของไฟล์ คือ filesize() ตามตัวอย่างโปรแกรม

```
01:<?php
02:	    $myfile = fopen("appname.txt", "r");
03:	    echo fread($myfile, filesize("appname.txt"));
04:	    fclose($myfile);
05:?>
```

[ดาวน์โหลด source code](src/ch06_07.php)

จากตัวอย่างโปรแกรมที่ 6.7 บรรทัดที่ 02 เป็นการเปิดไฟล์ “appname.txt” ในโหมดอ่านอย่างเดียว “r” เพื่ออ่านข้อความทั้งหมดมาแสดงผลตามบรรทัดที่ 03 โดยที่คำสั่ง filesize("appname.txt") คือ การคำนวณขนาดของไฟล์ “appname.txt” และทำการปิดไฟล์ในบรรทัดที่ 04 จากโปรแกรมดังกล่าวจะได้ผลลัพธ์ตามภาพ

<img src=img/0608.png>

จากภาพ เป็นการเปิดข้อมูลในไฟล์ appname.txt ในโหมดอ่านอย่างเดียว ซึ่งในไฟล์มีข้อความ “ChandraChatbot” ดังนั้น เมื่ออ่านค่าตามขนาดของไฟล์แล้วนำมาแสดงผลจึงปรากฏข้อมูลดังกล่าวบนเว็บเพจ 

### การอ่านไฟล์ทีละบรรทัด
การอ่านไฟล์ทีละบรรทัดในภาษาพีเอชพี (PHP) จะใช้ฟังก์ชัน fgets() และใช้ประเภทการเปิดไฟล์แบบเดียวกับฟังก์ชันอ่านไฟล์อื่น ๆ ซึ่งฟังก์ชัน fgets() จะเป็นการอ่านแล้วเลื่อนตำแหน่งตัวชี้ไปครั้งละ 1 แถว มีรูปแบบโครงสร้างคำสั่ง ดังนี้ 

```
fgets(ตัวแปรอ้างอิงการเปิดไฟล์);
```

การอ่านไฟล์จะระบุเพียง ตัวแปรอ้างอิงการเปิดไฟล์ โดยทั่วไปการเปิดไฟล์เพื่ออ่านจะมีตำแหน่งตัวชี้ของการอ่านค่าไฟล์อยู่ที่ต้นไฟล์ การใช้คำสั่ง fgets() ในการอ่านข้อมูลจะมีการขยับตำแหน่งในการอ่านไปครั้งละแถว การประยุกต์ใช้คำสั่งสามารถเขียนได้ตามตัวอย่างโปรแกรม

```
01:<?php
02:	   $myfile = fopen("userlog.txt", "r") or die("Unable to open file!");
03:	   while(!feof($myfile)) {
04:	       echo fgets($myfile)."<br>";
05:	   }
06:	   fclose($myfile);
07:?>
```

[ดาวน์โหลด source code](src/ch06_08.php)

จากตัวอย่างโปรแกรม บรรทัดที่ 02 เป็นการเปิดไฟล์ “userlog.txt” ในโหมดการอ่านอย่างเดียว “r” จากนั้นในบรรทัดที่ 03-05 จะทำการวนรอบอ่านไฟล์ทีละแถวเพื่อแสดงผล และบรรทัดที่ 06 ทำการปิดไฟล์ ซึ่งจะได้ผลลัพธ์ตามภาพ

<img src=img/0609.png>

จากภาพ แสดงข้อมูลในไฟล์ “userlog.txt” โดยการวนรอบอ่านข้อมูลมาแสดงผลจนครบทุกบรรทัด ซึ่งจะปรากฏข้อมูลดังกล่าวบนเว็บเพจในรูปแบบเดียวกัน

### การอ่านไฟล์ทีละตัวอักษร
การอ่านไฟล์ทีละตัวอักษรจะใช้ฟังก์ชัน fgetc() และ การเปิดอยู่ในโหมดแบบอ่าน เช่น โหมด “r” การทำงานของฟังก์ชัน fgetc() เป็นการอ่านแล้วเลื่อนตำแหน่งตัวชี้ไปครั้งละ 1 ตัวอักษร มีรูปแบบโครงสร้างคำสั่ง ดังนี้

```
fgetc(ตัวแปรอ้างอิงการเปิดไฟล์);
```

การใช้คำสั่ง fgetc() จะขยับตำแหน่งในการอ่านไปครั้งละตัวอักษร ซึ่งตัวอย่างการประยุกต์คำสั่งตามโปรแกรม

```
01:<?php
02:	   $myfile = fopen("myname.txt", "r") or die("Unable to open file!");
03:	   while(!feof($myfile)) {
04:	       $ch=fgetc($myfile);
05:	       if($ch!=' ') {
06:	          echo $ch;
07:	       } else {   
08:	          echo "<BR>"; 
09:	       }
10:	   }
11:	   fclose($myfile);
12:?>
```

[ดาวน์โหลด source code](src/ch06_09.php)

จากตัวอย่างโปรแกรม บรรทัดที่ 02 เป็นการเปิดไฟล์ “myname.txt” ในโหมดอ่านอย่างเดียว “r” ส่วน บรรทัดที่ 03-10 เป็นการวนรอบอ่านไฟล์ทีละแถวตัวอักษรมาแสดงผล โดยถ้าตัวอักษรที่อ่านได้เป็นช่องว่างจะขึ้นบรรทัดใหม่ และทำการปิดไฟล์ตามคำสั่งบรรทัด
ที่ 11 จะได้ผลลัพธ์ตามภาพ

<img src=img/0610.png>

### การเขียนไฟล์ตามข้อความที่กำหนด
การเขียนไฟล์ตามข้อความที่กำหนดมีเงื่อนไขคือ การเปิดไฟล์จะต้องเปิดแบบโหมดเขียน เช่น โหมด “a+” จึงจะสามาถเขียนไฟล์ได้ สำหรับเขียนไฟล์ตามข้อความที่กำหนดในภาษาพีเอชพี (PHP) จะใช้ฟังก์ชัน fwrite() มีโครงสร้างคำสั่งการเขียนไฟล์ ดังนี้

```
fwrite(ตัวแปรอ้างอิงการเปิดไฟล์, ข้อความหรือตัวแปรข้อความ);
```

จากคำสั่ง fwrite() จะใช้สำหรับการเขียนข้อความไปยังไฟล์ โดยตัวอย่างการประยุกต์คำสั่งตามตัวอย่างโปรแกรม

```
01:<?php
02:	   $myfile = fopen("lastlog.txt", "w+") or die("Unable to open file!");
03:	   $username = "Steve Rogers"; 
04:	   $action = "DELETE";
05:	   $date = date_format(date_create(), 'Y-m-d H:i:s');
06:	   $txt = $username.", ".$action.", ".$date."\n";
07:	   fwrite($myfile, $txt);
08:	   fclose($myfile);
09:	   echo "write \"$txt\" to userlog.txt";
10:?>
```

[ดาวน์โหลด source code](src/ch06_10.php)

จากตัวอย่างโปรแกรม บรรทัดที่ 02 ได้ทำการเปิดไฟล์ “lastlog.txt” ในโหมดแบบเขียนต่อ “a+” จากนั้นบรรทัดที่ 03-05 มีการกำหนดค่าตัวแปร 3 ค่า ได่แก่ ชื่อผู้ใช้ ($username) การดำเนินการ ($action) วันเวลา ($date) และในบรรทัดที่ 06 เป็นการนำตัวแปรทั้ง 3 ค่ามากำหนดเป็นข้อความในการเขียนเพื่อส่งค่าไปเก็บในตัวแปร $txt ก่อนนำไปเขียนลงไฟล์ในบรรทัดที่ 07 และ บรรทัดที่ 08 ทำการปิดไฟล์ และได้แสดงข้อความสถานะการเขียนในบรรทัดที่ 09 ซึ่งจะได้ผลลัพธ์เป็นไปตามภาพ

<img src=img/0611.png>

### การเขียนไฟล์ครั้งละบรรทัด
การเขียนไฟล์ครั้งละบรรทัดในภาษาพีเอชพี (PHP) ใช้ฟังก์ชัน fputs() มีรูปแบบโครงสร้าง ดังนี้

```
fputs(ตัวแปรอ้างอิงการเปิดไฟล์, ข้อความหรือตัวแปรข้อความ);
```

จากโครงสร้างสามารถเขียนโปรแกรมเพื่อประยุกต์คำสั่ง fputs() ตามโปรแกรม

```
01:<?php
02:	   $myfile = fopen("adminlog.txt", "w+") or die("Unable to open file!");
03:	   $username = " Tony Stark"; 
04:	   $action = "DELETE";
05:	   $date = date_format(date_create(), 'Y-m-d H:i:s');
06:	   $txt = $username.", ".$action.", ".$date."\n";
07:	   fputs($myfile, $txt);
08:	   fclose($myfile);
09:	   echo "write \"$txt\" to last_userlog.txt";
10:?>
```

[ดาวน์โหลด source code](src/ch06_11.php)

จากตัวอย่างโปรแกรม บรรทัดที่ 02 ได้ทำการเปิดไฟล์ “adminlog.txt” ในโหมดแบบเขียนทับ “w” จากนั้นดำเนินการคล้ายกับตัวอย่างโปรแกรมที่ 6.10 แต่การเขียนในโหมดนี้จะปรากฏผลลัพธ์ข้อความที่ผู้ใช้เขียนข้อมูลลงไปในไฟล์ล่าสุดเพียงบรรทัดเดียว ดังผลลัพธ์ตามภาพ

<img src=img/0612.png>

จากที่ได้อธิบายเกี่ยวกับการจัดการไฟล์ทั้งหมด สามารถสรุปลำดับในการจัดการ ได้แก่ การเปิดไฟล์ การจัดการอ่านหรือเขียนไฟล์ และ การปิดไฟล์ โดยมีฟังก์ชันที่ใช้งานสรุปได้ตามตาราง

| ฟังก์ชัน | ความหมาย |	ตัวอย่างการใช้งาน |
| --- | --- | --- |
| fopen() |	การเปิดไฟล์ |	$myfile = fopen("appname.txt ", "r") |
| fclose() | การปิดไฟล์ |	fclose($myfile) |
| fread() |	การอ่านไฟล์ |	fread($myfile, filesize("appname.txt") |
| fgets() |	การอ่านทีละแถว |	fgets($myfile) |
| fgetc() |	การอ่านทีละตัวอักษร |	fgetc($myfile) |
| fwrite() | การเขียนไฟล์ |	fwrite($myfile, $txt); |
| fputs() |	การเขียนทีละแถว |	fgets($myfile, $txt); |
| fbof() | ตำแหน่งเริ่มต้นสุดไฟล์ |	feof($myfile) |
| feof() | ตำแหน่งสิ้นสุดไฟล์ |	feof($myfile) |
| filesize() | ขนาดของไฟล์ |	filesize("appname.txt") |

---
#### [<< หน้าก่อนหน้า](0602.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0610.md)
---

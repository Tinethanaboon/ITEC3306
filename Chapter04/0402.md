## โครงสร้างและแบบจำลองฐานข้อมูล 
ระบบจัดการฐานข้อมูลที่เรียกว่า “ดีบีเอ็มเอส” (DBMS: Database Manaement System) เป็นโปรแกรมที่มีหน้าที่ใชการบริหารและจัดการฐานข้อมูล โดยดีบีเอ็มเอสจะทำหน้าที่เป็นตัวกลางในการจัดการฐานข้อมูลระหว่างโปรแกรมภาษา เช่น ภาษาพีเอชพี (PHP) กับ มายเอสคิวแอล (MySQL) เป็นต้น ระบบจัดการฐานข้อมูลที่นิยม ได้แก่ มายเอสคิวแอล (MySQL) ไมโครซอฟต์ แอคเซส (Microsoft Access)  ออราเคลิ (Oracle) 

ในที่นี้ จะใช้ตัวอย่างฐานข้อมูลทดสอบข้างต้นสำหรับการฝึกปฏิบัติการเขียนคำสั่งภาษาเอสคิวแอล (SQL) โดยผู้ใช้สามารถเริ่มต้นเข้าใช้งานเว็บไซต์ฝึกปฏิบัติการได้จากลิงค์ https://www.w3schools.com/sql/ 

<img src=img/0402.png>
ที่มา: https://www.w3schools.com/sql/ (ออนไลน์, 2561)

เมื่อทำการคลิกปุ่ม “Try it Yourself” จะลิงค์ไปสู่หน้าต่างเว็บเพจสำหรับเข้าไปฝึกปฏิบัติการเขียนคำสั่งด้วยภาษาเอสคิวแอล (SQL) และสามารถดูรายละเอียดโครงสร้างฐานข้อมูลได้ โดยฐานข้อมูลดังกล่าวเป็นฐานข้อมูลเชิงธุรกิจ แสดงดังภาพ

<img src=img/0403.png>
ที่มา: https://www.w3schools.com/sql/trysql.asp?filename=trysql_select_all (ออนไลน์, 2561)

จากภาพแสดงส่วนองค์ประกอบของหน้าจอสำหรับฝึกปฏิบัติการใช้คำสั่งภาษาเอสคิวแอล (SQL Tutorial) ผู้ใช้สามารถพิมพ์คำสั่งเอสคิวแอล (SQL) ที่ช่อง “SQL Statement” และสั่งประมวลผลโดยคลิกที่ “Run SQL” เพื่อดูผลลัพธ์ได้ 

#### ประเภทของคำสั่งภาษาเอสคิวแอล
คำสั่งภาษาเอสคิวแอล (SQL) สามารถจัดกลุ่มตามลักษณะการนำไปประยุกต์ใช้งานได้ 3 ประเภท (กิตติ ภักดีวัฒนะกุล และจำลอง ครุอุตสาหะ, 2550) ดังนี้ 
* กลุ่มดีดีแอล (DDL: Data Definition Language) เป็นกลุ่มคำสั่งที่ใช้สำหรับการสร้างฐานข้อมูล การกำหนดโครงสร้างข้อมูล และการจัดการความสัมพันธ์และสร้างดัชนี ประกอบด้วย คำสั่ง CREATE ใช้สำหรับการสร้างฐานข้อมูล/ตาราง คำสั่ง ALTER ใช้สำหรับจัดการคอลัมน์ เช่น เพิ่ม/ลบ/เปลี่ยน และ คำสั่ง DROP ใช้สำหรับลบฐานข้อมูล/ตาราง/ดัชนี ซึ่งโดยทั่วไปแล้ว กลุ่มคำสั่งกลุ่มเหล่านี้ใช้จะให้ในระดับสำหรับผู้พัฒนาระบบ โดยจัดการผ่าน
แอปพลิเคชันจัดการฐานข้อมูล
* กลุ่มดีเอ็มแอล (DML: Data Manipulation Language) เป็นกลุ่มคำสั่งที่ใช้สำหรับจัดการข้อมูล ประกอบด้วย คำสั่ง SELECT คือ การเลือกข้อมูล คำสั่ง INSERT คือการเพิ่มข้อมูล คำสั่ง DELETE คือการลบข้อมูล และ คำสั่ง UPDATE คือการปรับปรุงข้อมูล กลุ่มคำสั่งเหล่านี้จะใช้ในผู้ใช้งานระดับปฏิบัติการทั่วไป และส่วนใหญ่จะถูกนำไปประยุกต์ใช้ในการพัฒนาโปรแกรมประยุกต์ต่าง ๆ
* กลุ่มดีซีแอล (DCL: Data Control Language) เป็นกลุ่มคำสั่งสำหรับผู้ดูแลระบบฐานข้อมูล (Database Administrator) ใช้สำหรับควบคุมกำหนดสิทธิหรือยกเลิกการเข้าใช้ฐานข้อมูล ประกอบด้วย คำสั่ง GRANT ใช้ในการกำหนดสิทธิการเข้าใช้ และ คำสั่ง REVOKE ใช้สำหรับการยกเลิกสิทธิการเข้าใจ โดยทั่วไปการควบคุมกำหนดสิทธิจะใช้งานผ่านเครื่อง
แอปพลิเคชันจัดการฐานข้อมูลของผู้ดูแลระบบ

## การจัดการข้อมูลด้วยคำสั่งเอสคิวแอล
การจัดการข้อมูลด้วยคำสั่งเอสคิวแอล (SQL) จะใช้ประเภทคำสั่งในกลุ่มดีเอ็มแอล (DML: Data Manipulation Language) ได้แก่ 
### คำสั่งเลือก (SELECT) 
โดยในที่นี้จะขออธิบายรูปแบบการเขียน ดังนี้

#### รูปแบบที่ 1 การเลือกทุกเขตข้อมูล
```
    SELECT * FROM <ชื่อตาราง>;
```
โดยสัญลักษณ์ * หมายถึง ทุกเขตข้อมูล ส่วน <ชื่อตาราง> ให้ระบุชื่อตาราง โดยตัวอย่างการใช้งานตามโครงสร้าง เช่น
```
    SELECT * FROM Shippers;
```
ได้ผลลัพธ์

<img src=img/0404.png>

#### รูปแบบที่ 2 การเลือกโดยใช้บางเขตข้อมูล
```
    SELECT <รายการเขตข้อมูล> FROM <ชื่อตาราง>;
```
โดย <รายการเขตข้อมูล>  ให้ระบุรายการเขตข้อมูลที่ต้องการ ส่วน <ชื่อตาราง> ให้ระบุชื่อตาราง โดยตัวอย่างการใช้งานตามโครงสร้าง เช่น
```
    SELECT CategoryName, Description FROM Categories;
```
ได้ผลลัพธ์

<img src=img/0405.png>

#### รูปแบบที่ 3 การเลือกโดยมีการจำกัดขอบเขตจำนวนแถว
```
    SELECT <รายการเขตข้อมูล> FROM <ชื่อตาราง> LIMIT strat, num;
```
โดยมีส่วนที่ต้องระบุเพิ่มเติม คือ strat ให้ระบุลำดับเลขที่แถวเริ่มต้นที่เลือกได้ (เลข 0 หมายถึง แถวแรก) ส่วน num ให้จำนวนแถวที่ต้องการเลือก โดยตัวอย่างการใช้งานตามโครงสร้าง เช่น
```
    SELECT CustomerName, ContactName, City, Country FROM Customers LIMIT 0, 5;
```
ได้ผลลัพธ์

<img src=img/0406.png>

#### รูปแบบที่ 4 การเลือกโดยมีการกำหนดเงื่อนไขการเลือก
```
    SELECT <รายการเขตข้อมูล> FROM <ชื่อตาราง> WHERE <เงื่อนไข>;                            
```
โดยมีส่วนที่ต้องระบุเพิ่มเติม คือ <เงื่อนไข> ให้ระบุเงื่อนไข ดังนี้

**ตัวดำเนินการสำหรับกำหนดเงื่อนไขในภาษาเอสคิวแอล (SQL)**
* ```=	แทน เท่ากับ	มีตัวอย่าง เช่น ContactName = "Maria Anders"```
* ```!= แทน ไม่เท่ากับ มีตัวอย่าง เช่น ShipperName != "Speedy Express"```
* ```< แทน น้อยกว่า มีตัวอย่าง เช่น Price < 50```
* ```<= แทน น้อยกว่าเท่ากับ มีตัวอย่าง เช่น Price <= 50```
* ```> แทน มากกว่า มีตัวอย่าง เช่น Price > 100```
* ```>= แทน มากกว่าเท่ากับ มีตัวอย่าง เช่น Price >= 100```
* ```BETWEEN…AND...แทน ระหว่าง...และ... มีตัวอย่าง เช่น Price BETWEEN 50 AND 100```
* ```LIKE แทน ใกล้เคียง	LastName LIKE "K%";```
* ```IN (…) แทน อยู่ในรายการ	มีตัวอย่าง เช่น Country IN ("UK", "USA")```
* ```AND	แทน ตัวเชื่อมและ มีตัวอย่าง เช่น CustomerName LIKE "A%" AND Country IN ("UK", "USA")```
* ```OR	แทน ตัวเชื่อมหรือ มีตัวอย่าง เช่น Price < 50 OR CategoryID = 1```

* ตัวอย่างที่ 1 การใช้เงื่อนไขเชิงเปรียบเทียบ
```
    SELECT * FROM Products WHERE Price >= 100;
```
ได้ผลลัพธ์

<img src=img/0407.png>

* ตัวอย่างที่ 2 การเลือกเป็นช่วง
```
    SELECT * FROM Products WHERE Price BETWEEN 50 AND 100;
```
ได้ผลลัพธ์

<img src=img/0408.png>

* ตัวอย่างที่ 3 การเลือกแบบ LIKE
เป็นการใช้สัญลักษณ์ในการแทนค่าการเปรียบเทียบร่วม ได้แก่ “%” ซึ่งจะแทนอักษรใด ๆ ช่วงที่ระบุสัญลักษณ์ และ “_” เป็นการล็อคลำดับอักษร เช่น “_K%” หมายถึง ข้อมูลที่ตัวอักษรลำดับที่สองคือ “K” แล้วตามท้ายด้วยตัวอักษรใด ๆ ดังตัวอย่างการใช้งาน ดังนี้
```
    SELECT * FROM Employees WHERE LastName LIKE "K%";
```
ได้ผลลัพธ์

<img src=img/0409.png>

* ตัวอย่างที่ 4 การเลือกในค่าที่กำหนด
```
    SELECT * FROM Customers WHERE Country IN ("UK", "USA") LIMIT 0, 3;
```
ได้ผลลัพธ์

<img src=img/0410.png>

* ตัวอย่างที่ 5 การใช้ตัวเชื่อมเงื่อนไข 
```
    SELECT * FROM Customers 
    WHERE CustomerName LIKE "A%" AND Country IN ("UK", "USA");
```
ได้ผลลัพธ์

<img src=img/0411.png>

#### รูปแบบที่ 5 การเลือกโดยมีการจัดเรียงข้อมูล 
สามารถเขียนคำสั่งโดยใช้โครงสร้างตามรูปแบบ ดังนี้
```
    SELECT <รายการเขตข้อมูล> FROM <ชื่อตาราง> WHERE <เงื่อนไข>
    ORDER BY <รายการเขตข้อมูลที่ต้องการจัดเรียง> [ASC/DESC];
```
ตัวอย่าง เช่น 
```
    SELECT * FROM Products WHERE Price BETWEEN 50 AND 100
    ORDER BY Price ASC;
```
ได้ผลลัพธ์

<img src=img/0412.png>

#### รูปแบบที่ 6 การเลือกโดยกลุ่มข้อมูลมาเพียงกลุ่มละรายการเดียว 
สามารถเขียนคำสั่งโดยใช้โครงสร้างตามรูปแบบ ดังนี้
```
    SELECT <รายการเขตข้อมูล> FROM <ชื่อตาราง> 
    GROUP BY <เขตข้อมูลที่ต้องการกลุ่มข้อมูล>; 
```
ตัวอย่าง เช่น 
```
    SELECT Country FROM Customers 
    GROUP BY Country LIMIT 0, 5;
```
ได้ผลลัพธ์

<img src=img/0413.png>

#### รูปแบบที่ 7 การเลือกโดยใช้ฟังก์ชันคำนวณหรือสูตร
สามารถเขียนคำสั่งโดยใช้โครงสร้างตามรูปแบบ ดังนี้
```
    SELECT <ฟังก์ชันคำนวณ/สูตร> AS <ตั้งชื่อเขตข้อมูลใหม่> 
    FROM <ชื่อตาราง>;
```
จากโครงสร้างคำสั่งข้างต้นมีส่วนที่ต้องระบุเพิ่มเติม คือ <ฟังก์ชันคำนวณ/สูตร> ที่ใช้ระบุฟังก์ชันการคำนวณที่ต้องการใช้ โดยฟังก์ชันคำนวณและสูตรที่ใช้ในคำสั่งเอสคิวแอล (SQL) ดังนี้

**ตัวอย่างฟังก์ชันคำนวณ/สูตร ที่ใช้ในคำสั่งเอสคิวแอล (SQL)**
* ```MAX() คือฟังก์ชันค่าสูงสุด	มีตัวอย่างการใช้ เช่น SELECT MAX(Price) AS MaxPrice FROM Products;```
* ```MIN() คือฟังก์ชันค่าต่ำสุด มีตัวอย่างการใช้ เช่น SELECT MIN(Price) AS MinPrice FROM Products;```
* ```AVG() คือฟังก์ชันค่าเฉลี่ย มีตัวอย่างการใช้ เช่น SELECT AVG(Price) AS AvgPrice FROM Products;```
* ```COUNT() คือฟังก์ชันนับจำนวน	มีตัวอย่างการใช้ เช่น SELECT Country, COUNT(Country) AS NumCountry FROM Customers GROUP BY Country;```

* ตัวอย่างที่ 1 การเลือกแบบใช้ฟังก์ชันการคำนวณค่าเดี่ยว
```
    SELECT MAX(Price) AS MaxPrice, MIN(Price) AS MinPrice,  
    AVG(Price) AS AvgPrice FROM Products;
```
ได้ผลลัพธ์

<img src=img/0414.png>

* ตัวอย่างที่ 2 การเลือกแบบใช้ฟังก์ชันการนับจำนวน 
```
    SELECT CategoryID, COUNT(CategoryID) AS NumCategory 
    FROM Products GROUP BY CategoryID ORDER BY CategoryID ASC;
```
ได้ผลลัพธ์

<img src=img/0415.png>

* ตัวอย่างที่ 3 การเลือกแบบใช้สูตร 
```
    SELECT ProductName, Price, Price+5 AS PriceAdd5 FROM Products;
```
ได้ผลลัพธ์

<img src=img/0416.png>

#### รูปแบบที่ 8 การเลือกมากกว่า 1 ตาราง โดยใช้เงื่อนไข (WHERE) 
สามารถเขียนคำสั่งโดยใช้โครงสร้างตามรูปแบบ ดังนี้
```
    SELECT <รายการเขตข้อมูลตามตาราง> FROM <รายการตาราง>
    WHERE <เงื่อนไขการเชื่อมตาราง>;
```
ตัวอย่างการเขียนคำสั่งตามโครงสร้าง มีดังนี้
```
    SELECT p.ProductName, c.CategoryName FROM Products p, Categories c
    WHERE p.CategoryID = c.CategoryID;
```
ได้ผลลัพธ์

<img src=img/0417.png>

#### รูปแบบที่ 9 การเลือกมากกว่า 1 ตาราง โดยใช้คำสั่งกลุ่มจอย (JOIN) 
สามารถเขียนคำสั่งโดยใช้โครงสร้างตามรูปแบบ ดังนี้
```
    SELECT <รายการเขตข้อมูลตามตาราง> FROM (<ชื่อตารางต้น>
    [INNER/LEFT/RIGHT/FULL] JOIN <ชื่อตารางที่จะจอย> 
    ON <เงื่อนไขการจอย>);
```
จากโครงสร้างข้างต้นสามารถเขียนคำสั่งภาษาเอสคิวแอล (SQL) โดยมีรูปแบบการจอย (JOIN) หลายประเภท ดังนี้

**ประเภทการจอย (JOIN)**
* ```INNER JOIN	คือ การจอยภายใน	ดำเนินการโดยจะรวมข้อมูลที่เลือกเชื่อมต่อมา```
* ```LEFT JOIN คือ การจอยซ้าย ดำเนินการโดยจะรวมข้อมูลที่ตรงกัน โดยจะเน้นตารางฝั่งซ้ายเป็นหลัก```
* ```RIGHT JOIN คือ การจอยขวา ดำเนินการโดยจะรวมข้อมูลที่ตรงกัน โดยจะเน้นตารางฝั่งขวาเป็นหลัก```
* ```FULL JOIN คือ การจอยเต็ม ดำเนินการโดยจะรวมข้อมูลที่ตรงกัน โดยรวมจากตารางทั้ง 2 ฝั่ง```

ตัวอย่างการเขียนคำสั่งตามโครงสร้าง มีดังนี้
```
    SELECT o.OrderID, c.CustomerName
    FROM (Orders o 
    INNER JOIN Customers c ON o.CustomerID = c.CustomerID);
```
ได้ผลลัพธ์

<img src=img/0418.png>

กรณีหากต้องการจอย (JOIN) ตารางเพิ่ม เช่น
```
    SELECT o.OrderID, c.CustomerName, s.ShipperName
    FROM ((Orders o
    INNER JOIN Customers c ON o.CustomerID = c.CustomerID)
    INNER JOIN Shippers s ON o.ShipperID = s.ShipperID);
```
ได้ผลลัพธ์

<img src=img/0419.png>

### คำสั่งแทรก (INSERT)
เป็นคำสั่งสำหรับการเพิ่มแถวหรือระเบียนข้อมูลใหม่เข้าไปในตารางเป้าหมาย มีรูปแบบโครงสร้างคำสั่ง ดังนี้
```
    INSERT INTO <ชื่อตาราง> (<รายการเขตข้อมูลทั้งหมด>)
    VALUES (<รายการค่าที่ต้องการเพิ่มตรงกับเขตข้อมูล>);
```
โดย <ชื่อตาราง> คือ ชื่อตารางที่ต้องการเพิ่ม
	<รายการเขตข้อมูลทั้งหมด> คือ รายการเขตข้อมูลของตาราง
	<รายการค่าที่ต้องการเพิ่มตรงกับเขตข้อมูล> คือ รายการค่า โดยกรณีเป็นข้อความควรระบุไว้ภายใต้เครื่องหมายคำพูด (' ')
ตัวอย่าง เช่น
```
    INSERT INTO Shippers (ShipperID, ShipperName, Phone)
    VALUES (NULL, 'IfyouNeedShipping', '(66) 899-999-999');
```
เมื่อทำการเพิ่มข้อมูล ตารางข้อมูลได้มีการเปลี่ยนแปลง ดังนี้

<img src=img/0420.png>

### คำสั่งปรับปรุง (UPDATE) 
เป็นคำสั่งสำหรับการปรับปรุงข้อมูลในแถวหรือระเบียนข้อมูลไปในตารางเป้าหมาย มีรูปแบบโครงสร้างคำสั่ง ดังนี้
```
    UPDATE <ชื่อตาราง> SET <รายการปรับปรุง>
    WHERE <เงื่อนไข>;
```
โดย <ชื่อตาราง> คือ ชื่อตารางที่ต้องการเพิ่ม
	<รายการปรับปรุง> คือ รายการปรับปรุงเขตข้อมูลในตาราง เช่น Phone = '(66) 88-888-8888' เป็นต้น
	<เงื่อนไข> ให้ระบุเงื่อนไขการปรับปรุงโดยการเปลี่ยนแปลงจะกระทบกับแถวตามเงื่อนไขที่กำหนด เช่น ShipperID = 4 เป็นต้น
ตัวอย่าง เช่น
```
    UPDATE Shippers SET ShipperName = 'NeedShipping', 
    Phone = '(66) 88-888-8888' 
    WHERE ShipperID = 4;
```
จากคำสั่งทำการปรับปรุงข้อมูลโดยที่ ShipperID = 4 ทำให้ตารางข้อมูลมีการเปลี่ยนแปลง ดังนี้

<img src=img/0421.png>

### คำสั่งลบ (DELETE)
เป็นคำสั่งสำหรับการลบแถวหรือระเบียนข้อมูลออกจากตารางเป้าหมาย มีรูปแบบโครงสร้างคำสั่ง ดังนี้
```
    DELETE FROM <ชื่อตาราง>
    WHERE <เงื่อนไข>;
```
โดย <ชื่อตาราง> คือ ชื่อตารางที่ต้องการเพิ่ม
	<เงื่อนไข> ให้ระบุเงื่อนไขการลบโดยจะกระทบกับแถวตามเงื่อนไขที่กำหนด เช่น ShipperID = 4 เป็นต้น
ตัวอย่าง เช่น
```
    DELETE FROM Shippers
    WHERE ShipperID = 4;
```
จากคำสั่งทำการลบรายการที่มี ShipperID = 4 ทำให้ตารางข้อมูลมีการเปลี่ยนแปลง ดังนี้

<img src=img/0422.png>

---
#### [<< หน้าก่อนหน้า](0401.md) | [หน้าเลือกหัวข้อ](README.md) | [หน้าต่อไป >>](0403.md)
---
